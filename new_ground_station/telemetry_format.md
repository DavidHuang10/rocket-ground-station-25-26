# ERIS Delta Telemetry Output Format

## Overview

The ERIS Delta flight computer broadcasts telemetry data as a comma-separated string via LoRa radio every 500ms. This document describes the format of that data string.

## Transmission Details

- **Protocol**: LoRa (RH_RF95)
- **Frequency**: 923.5 MHz (configurable in `config.h`)
- **Transmit Interval**: 500ms (configurable as `TRANSMIT_DELAY`)
- **Max Packet Size**: 256 bytes
- **Format**: CSV (Comma-Separated Values)

## Data Fields

The telemetry string contains 29 fields in the following order:

| Index | Field Name | Type | Units | Description |
|-------|------------|------|-------|-------------|
| 0 | `cur_time` | unsigned long | ms | Timestamp of current cycle (milliseconds since boot) |
| 1 | `gps_lat` | long | degrees × 10^7 | GPS latitude (scaled integer) |
| 2 | `gps_lng` | long | degrees × 10^7 | GPS longitude (scaled integer) |
| 3 | `gps_alt` | long | mm | GPS altitude above MSL |
| 4 | `accel[0]` | double | m/s² | Most recent Z-axis acceleration (vertical) |
| 5 | `accel_y` | double | m/s² | Y-axis acceleration |
| 6 | `accel_z` | double | m/s² | Z-axis acceleration |
| 7 | `gyro_x` | double | rad/s | X-axis gyroscope (roll rate) |
| 8 | `gyro_y` | double | rad/s | Y-axis gyroscope (pitch rate) |
| 9 | `gyro_z` | double | rad/s | Z-axis gyroscope (yaw rate) |
| 10 | `hg_accel[0]` | double | m/s² | Most recent high-G accelerometer reading |
| 11 | `alt[0]` | double | m | Most recent barometric altitude (AGL) |
| 12 | `vel[0]` | double | m/s | Most recent calculated vertical velocity |
| 13 | `smooth_vel` | double | m/s | Smoothed vertical velocity |
| 14 | `press` | double | hPa | Barometric pressure |
| 15 | `temp` | double | °C | Temperature from barometer |
| 16 | `launchsite_msl` | double | m | Launch site altitude (MSL baseline) |
| 17 | `airbrake_cont` | bool | - | Airbrake servo continuity (0/1) |
| 18 | `ab_servo_pct` | double | % | Airbrake servo position (percentage) |
| 19 | `cnrd_servo_pct` | double | % | Canard servo position (percentage) |
| 20 | `drogue_pyro_cont_1` | bool | - | Drogue pyro channel 1 continuity (0/1) |
| 21 | `drogue_pyro_cont_2` | bool | - | Drogue pyro channel 2 continuity (0/1) |
| 22 | `main_pyro_cont_1` | bool | - | Main parachute pyro channel 1 continuity (0/1) |
| 23 | `main_pyro_cont_2` | bool | - | Main parachute pyro channel 2 continuity (0/1) |
| 24 | `flight_index` | int | - | Flight plan index for airbrake control |
| 25 | `ellipse_on` | bool | - | Ellipse INS power status (0/1) |
| 26 | `cameras_on` | bool | - | Camera system power status (0/1) |
| 27 | `battery_voltage` | double | V | Main battery voltage |
| 28 | `flight_stage` | int | - | Current flight stage (see below) |

## Flight Stage Values

The `flight_stage` field is a cumulative integer representing the rocket's state:

| Value | Stage | Description |
|-------|-------|-------------|
| 0 | Idle | On pad, waiting for launch |
| 1 | Takeoff | Liftoff detected |
| 2 | Burn | Motor burning + takeoff |
| 3 | Coast | Burnout detected, coasting to apogee |
| 4 | Apogee | Apogee reached, drogue deployed |
| 5 | Main | Main parachute deployed |
| 6 | Landed | Touchdown detected |

**Note**: The stage is calculated as the sum of boolean flags:
```cpp
flight_stage = takeoff + burnout + flightplan_done + apogee + main + landed
```

## Example Output

```
12453,401234567,-1051234567,1523000,15.2,0.3,-0.1,0.02,0.01,0.15,18.7,487.3,32.5,31.8,952.3,22.1,1420.0,1,62.5,50.0,1,1,1,1,3,1,1,12.4,3
```

## Data Logging

The same telemetry string is simultaneously:
1. **Broadcast** via LoRa radio to ground station
2. **Logged** to onboard flash memory (LittleFS)
3. **Transmitted** to black box serial recorder (Serial8 @ 115200 baud)

## Header Row

When logging to flash storage, the following CSV header is written:

```
cur_time,gps_lat,gps_lng,gps_alt,accel[0],accel_y,accel_z,gyro_x,gyro_y,gyro_z,hg_accel[0],alt[0],vel[0],smooth_v,press,temp,launchsite_msl,servo_cont,servo_pct,apogee_pyro_cont_1,apogee_pyro_cont_2,main_pyro_cont_1,main_pyro_cont_2,flight_index,ellipse_on,cameras_on,battery_voltage,flight_stage
```

## Implementation Details

- Generated by: `Data::to_string()` in `Data.cpp` (lines 253-305)
- Transmitted by: `Logger::send()` in `Logger.cpp` (lines 43-51)
- String stored in: `Data.out` member variable (defined in `Data.h` line 113)

## Notes

- GPS coordinates are scaled integers (divide by 10^7 to get decimal degrees)
- Array indices like `accel[0]`, `alt[0]`, `vel[0]` refer to the most recent reading in a rolling buffer
- Boolean fields transmit as `0` (false) or `1` (true)
- If telemetry transmission fails or packet is lost, the next packet arrives within 500ms

